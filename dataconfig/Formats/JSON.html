<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>JSON - DataConfig Book</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Serialization framework for Unreal Engine that just works!">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Intro</a></li><li class="chapter-item expanded "><a href="../Examples/index.html"><strong aria-hidden="true">2.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Examples/Custom.html"><strong aria-hidden="true">2.1.</strong> Custom</a></li><li class="chapter-item expanded "><a href="../Examples/DebugDump.html"><strong aria-hidden="true">2.2.</strong> Debug Dump</a></li></ol></li><li class="chapter-item expanded "><a href="../Integration.html"><strong aria-hidden="true">3.</strong> Integration</a></li><li class="chapter-item expanded "><a href="../Design.html"><strong aria-hidden="true">4.</strong> Design</a></li><li class="chapter-item expanded "><a href="../Programming/index.html"><strong aria-hidden="true">5.</strong> Programming</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Programming/DataModel.html"><strong aria-hidden="true">5.1.</strong> Data Model</a></li><li class="chapter-item expanded "><a href="../Programming/ErrorHandling.html"><strong aria-hidden="true">5.2.</strong> Error Handling</a></li><li class="chapter-item expanded "><a href="../Programming/Env.html"><strong aria-hidden="true">5.3.</strong> Env</a></li><li class="chapter-item expanded "><a href="../Programming/ReaderWriter.html"><strong aria-hidden="true">5.4.</strong> Reader Writer</a></li><li class="chapter-item expanded "><a href="../Programming/SerializerDeserializer.html"><strong aria-hidden="true">5.5.</strong> Serializer Deserializer</a></li></ol></li><li class="chapter-item expanded "><a href="../Formats/index.html"><strong aria-hidden="true">6.</strong> Formats</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Formats/JSON.html" class="active"><strong aria-hidden="true">6.1.</strong> JSON</a></li><li class="chapter-item expanded "><a href="../Formats/MsgPack.html"><strong aria-hidden="true">6.2.</strong> MsgPack</a></li><li class="chapter-item expanded "><a href="../Formats/Property.html"><strong aria-hidden="true">6.3.</strong> Property</a></li></ol></li><li class="chapter-item expanded "><a href="../Extra/index.html"><strong aria-hidden="true">7.</strong> Extra</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Extra/FColor.html"><strong aria-hidden="true">7.1.</strong> FColor</a></li><li class="chapter-item expanded "><a href="../Extra/Base64.html"><strong aria-hidden="true">7.2.</strong> Base64 Blob</a></li><li class="chapter-item expanded "><a href="../Extra/WriterAPI.html"><strong aria-hidden="true">7.3.</strong> WriterAPI</a></li><li class="chapter-item expanded "><a href="../Extra/JsonConverter.html"><strong aria-hidden="true">7.4.</strong> JsonConverter</a></li><li class="chapter-item expanded "><a href="../Extra/AnyStruct.html"><strong aria-hidden="true">7.5.</strong> AnyStruct</a></li><li class="chapter-item expanded "><a href="../Extra/InlineStruct.html"><strong aria-hidden="true">7.6.</strong> InlineStruct</a></li><li class="chapter-item expanded "><a href="../Extra/FieldRenamer.html"><strong aria-hidden="true">7.7.</strong> Field Renamer</a></li><li class="chapter-item expanded "><a href="../Extra/PropertyPath.html"><strong aria-hidden="true">7.8.</strong> Property Path</a></li><li class="chapter-item expanded "><a href="../Extra/SQLite.html"><strong aria-hidden="true">7.9.</strong> SQLite</a></li><li class="chapter-item expanded "><a href="../Extra/ModuleSetup.html"><strong aria-hidden="true">7.10.</strong> Module Setup</a></li><li class="chapter-item expanded "><a href="../Extra/DumpAssetToLog.html"><strong aria-hidden="true">7.11.</strong> Dump Asset To Log</a></li><li class="chapter-item expanded "><a href="../Extra/Blueprint.html"><strong aria-hidden="true">7.12.</strong> Blueprint</a></li><li class="chapter-item expanded "><a href="../Extra/GameplayTag.html"><strong aria-hidden="true">7.13.</strong> Gameplay Tag</a></li><li class="chapter-item expanded "><a href="../Extra/GameplayAbility.html"><strong aria-hidden="true">7.14.</strong> Gameplay Ability</a></li><li class="chapter-item expanded "><a href="../Extra/InstancedStruct.html"><strong aria-hidden="true">7.15.</strong> InstancedStruct</a></li></ol></li><li class="chapter-item expanded "><a href="../Advanced/index.html"><strong aria-hidden="true">8.</strong> Advanced</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Advanced/Benchmark.html"><strong aria-hidden="true">8.1.</strong> Benchmark</a></li><li class="chapter-item expanded "><a href="../Advanced/WritingHandlers.html"><strong aria-hidden="true">8.2.</strong> Writing Handlers</a></li><li class="chapter-item expanded "><a href="../Advanced/NonClassStructRoot.html"><strong aria-hidden="true">8.3.</strong> Non Class/Struct Root</a></li><li class="chapter-item expanded "><a href="../Advanced/Automation.html"><strong aria-hidden="true">8.4.</strong> Automation</a></li><li class="chapter-item expanded "><a href="../Advanced/UEUpgrades.html"><strong aria-hidden="true">8.5.</strong> UE Upgrades</a></li></ol></li><li class="chapter-item expanded "><a href="../Changes.html"><strong aria-hidden="true">9.</strong> Changes</a></li><li class="chapter-item expanded "><a href="../License.html"><strong aria-hidden="true">10.</strong> License</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DataConfig Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/slowburn-dev/DataConfig" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="json"><a class="header" href="#json">JSON</a></h1>
<p><a href="https://www.json.org/json-en.html" title="Introducing JSON">JSON</a> is likely the most popular data interchange format. Unreal Engine already supports it with <a href="https://docs.unrealengine.com/4.27/en-US/API/Runtime/JsonUtilities/" title="JsonUtilities"><code>JsonUtilities</code></a> and some related modules. We provide an alternative implementation along with DataConfig.</p>
<h2 id="json-reader"><a class="header" href="#json-reader">JSON Reader</a></h2>
<p><code>FDcJsonReader</code> is the DataConfig JSON reader:</p>
<pre><code class="language-c++">// DataConfigTests/Private/DcTestBlurb.cpp
FString Str = TEXT(R&quot;(
    {
        &quot;Str&quot;:    &quot;Fooo&quot;,
        &quot;Number&quot;: 1.875,
        &quot;Bool&quot;:   true
    } 
)&quot;);

FDcJsonReader Reader(Str);

//  calling read methods
FString KeyStr;
FString GotStr;
double GotNumber;
bool GotBool;

DC_TRY(Reader.ReadMapRoot());

    DC_TRY(Reader.ReadString(&amp;KeyStr));
    DC_TRY(Reader.ReadString(&amp;GotStr));

    DC_TRY(Reader.ReadString(&amp;KeyStr));
    DC_TRY(Reader.ReadDouble(&amp;GotNumber));

    DC_TRY(Reader.ReadString(&amp;KeyStr));
    DC_TRY(Reader.ReadBool(&amp;GotBool));

DC_TRY(Reader.ReadMapEnd());

//  validate results
check(GotStr == TEXT(&quot;Fooo&quot;));
check(GotNumber == 1.875);
check(GotBool == true);
</code></pre>
<p>In the example above we deserialized a <code>JSON</code> object from string. The first and last calls are <code>ReadMapRoot</code> and <code>ReadMapEnd</code>, which are also used to read Unreal's <code>TMap</code> properties. The difference is that UE's <code>TMap</code> is strictly typed while JSON object values can have arbitrary type. This means that if you use <code>FDcPipeVisitor</code> to pipe a <code>FDcJsonReader</code> into a <code>FDcPropertyWriter</code> it won't work.</p>
<p>Remember that DataConfig data model is designed to support conversion between subsets within the data model. As long as you can use <code>FDcReader/FDcWriter</code> API to describe the format you want to serialize you're good to go. Mapping and conversion between these different shapes of reader/writers are handled by <a href="../Programming/SerializerDeserializer.html">deserializers</a>.</p>
<p>Some additional caveats:</p>
<ul>
<li>Similar to stock <code>TJsonReader</code>, we provide <code>TDcJsonReader</code> with 2 specializations:
<ul>
<li>Usually you just use <code>FDcJsonReader</code> that reads from <code>FString, TCHAR*</code>.</li>
<li>Under the hood there're <code>FDcAnsiJsonReader</code> that reads ANSICHAR string
and <code>FDcWideJsonReader</code> that reads WIDECHAR string.</li>
</ul>
</li>
<li>We support a relaxed superset of JSON:
<ul>
<li>Allow C Style comments, i.e <code>/* block */</code> and <code>// line</code> .</li>
<li>Allow trailing comma, i.e <code>[1,2,3,],</code> .</li>
<li>Allow non object root. You can put a list as the root, or even string, numbers.</li>
</ul>
</li>
<li>Number parsing are delegated to Unreal's built-ins to reduce dependencies. We might change this in the future.
<ul>
<li>Parse numbers: <code>TCString::Atof/Strtoi/Strtoi64</code></li>
</ul>
</li>
</ul>
<h2 id="json-writer"><a class="header" href="#json-writer">JSON Writer</a></h2>
<p><code>FDcJsonWriter</code> is the DataConfig JSON writer:</p>
<pre><code class="language-c++">// DataConfigTests/Private/DcTestBlurb.cpp
FDcJsonWriter Writer;

DC_TRY(Writer.WriteMapRoot());

    DC_TRY(Writer.WriteString(TEXT(&quot;Str&quot;)));
    DC_TRY(Writer.WriteString(TEXT(&quot;Fooo&quot;)));

    DC_TRY(Writer.WriteString(TEXT(&quot;Number&quot;)));
    DC_TRY(Writer.WriteFloat(1.875f));

    DC_TRY(Writer.WriteString(TEXT(&quot;Bool&quot;)));
    DC_TRY(Writer.WriteBool(true));

DC_TRY(Writer.WriteMapEnd());
Writer.Sb.Append(TCHAR('\n'));

FString Str = TEXT(R&quot;(
    {
        &quot;Str&quot; : &quot;Fooo&quot;,
        &quot;Number&quot; : 1.875,
        &quot;Bool&quot; : true
    }
)&quot;);

//  validate results
check(DcReindentStringLiteral(Str) == Writer.Sb.ToString());
return DcOk();
</code></pre>
<ul>
<li>Similar to stock <code>TJsonWriter</code>, we provide <code>TDcJsonWriter</code> with 2 specializations:
<ul>
<li>Usually you just use <code>FDcJsonWriter</code> that writes <code>FString, TCHAR*</code>.</li>
<li>Under the hood there're <code>FDcAnsiJsonWriter</code> that writes ANSICHAR string
and <code>FDcWideJsonWriter</code> that writes WIDECHAR string.</li>
</ul>
</li>
<li>It takes a <code>Config</code> object that specify formatting settings like indentation size and new lines.
<ul>
<li><code>FDcPrettyJsonWriter</code> is a type alias that formats indented JSON.</li>
<li><code>FDcCondensedJsonWriter</code> is a type alias that format single line, condensed output. </li>
</ul>
</li>
<li><code>FDcJsonWriter</code> owns the output string buffer, in <code>FDcJsonWriter::Sb</code>.
<ul>
<li>By writing to a single writer and appending a new line after each serialization, we can output <a href="http://ndjson.org/" title="ndjson">NDJSON</a>. </li>
<li>Our JSON reader is also flexible enough to directly load NDJSON. See <a href="../Advanced/Benchmark.html">corpus benchmark</a>. </li>
</ul>
</li>
</ul>
<h2 id="json-serializedeserialize"><a class="header" href="#json-serializedeserialize">JSON Serialize/Deserialize</a></h2>
<p>DataConfig bundles a set of JSON serialize and deserialize handlers, which are all roundtrip-able:</p>
<pre><code class="language-c++">// DataConfigTests/Private/DcTestBlurb.cpp
#include &quot;DataConfig/Deserialize/DcDeserializerSetup.h&quot;

// ...
//  create and setup a deserializer
FDcDeserializer Deserializer;
DcSetupJsonDeserializeHandlers(Deserializer);

//  create and setup a serializer
FDcSerializer Serializer;
DcSetupJsonSerializeHandlers(Serializer);
</code></pre>
<h3 id="schema"><a class="header" href="#schema">Schema</a></h3>
<p>JSON types get mapped into DataConfig data model in a very unsurprising way.</p>
<table><thead><tr><th style="text-align: left">JSON Type</th><th>DcDataEntry</th></tr></thead><tbody>
<tr><td style="text-align: left">Boolean</td><td>Bool</td></tr>
<tr><td style="text-align: left">Null</td><td>Nil</td></tr>
<tr><td style="text-align: left">String</td><td>String, Name, Text, Enum</td></tr>
<tr><td style="text-align: left">Number</td><td>(All numerics)</td></tr>
<tr><td style="text-align: left">Array</td><td>Array, Set</td></tr>
<tr><td style="text-align: left">Object</td><td>Class, Struct, Map</td></tr>
</tbody></table>
<p>Here's an example:</p>
<pre><code class="language-c++">// DataConfigTests/Private/DcTestDeserialize.cpp
FString Str = TEXT(R&quot;(
    {
        &quot;BoolField&quot; : true,
        &quot;NameField&quot; : &quot;AName&quot;,
        &quot;StringField&quot; : &quot;AStr&quot;,
        &quot;TextField&quot; : &quot;AText&quot;,
        &quot;EnumField&quot; : &quot;Tard&quot;,

        &quot;FloatField&quot; : 17.5,
        &quot;DoubleField&quot; : 19.375,

        &quot;Int8Field&quot; : -43,
        &quot;Int16Field&quot; : -2243,
        &quot;Int32Field&quot; : -23415,
        &quot;Int64Field&quot; : -1524523,

        &quot;UInt8Field&quot; : 213,
        &quot;UInt16Field&quot; : 2243,
        &quot;UInt32Field&quot; : 23415,
        &quot;UInt64Field&quot; : 1524523,
    }
)&quot;);

//  deserialized equivelent

FDcTestStruct1 Expect;
Expect.BoolField = true;
Expect.NameField = TEXT(&quot;AName&quot;);
Expect.StringField = TEXT(&quot;AStr&quot;);
Expect.TextField = FText::FromString(TEXT(&quot;AText&quot;));
Expect.EnumField = EDcTestEnum1::Tard;

Expect.FloatField = 17.5f;
Expect.DoubleField = 19.375;

Expect.Int8Field = -43;
Expect.Int16Field = -2243;
Expect.Int32Field = -23415;
Expect.Int64Field = -1524523;

Expect.UInt8Field = 213;
Expect.UInt16Field = 2243,
Expect.UInt32Field = 23415;
Expect.UInt64Field = 1524523;
</code></pre>
<h3 id="map"><a class="header" href="#map">Map</a></h3>
<p>JSON only allow string as object/mapping keys, while in UE <code>TMap&lt;&gt;</code> can use any type. When doing serialization <code>TMap&lt;FString/FName/FText,(TValue)&gt;</code> types would be directly converted to a JSON object:</p>
<pre><code class="language-c++">// DataConfigTests/Public/DcTestDeserialize.h
USTRUCT()
struct FDcTestStruct3
{
    // ...
    UPROPERTY() TMap&lt;FString, FString&gt; StringMap;
};

// DataConfigTests/Public/DcTestDeserialize.cpp
{
    // ...
    &quot;StringMap&quot; : {
        &quot;One&quot;: &quot;1&quot;,
        &quot;Two&quot;: &quot;2&quot;, 
        &quot;Three&quot;: &quot;3&quot;,
    },
}
</code></pre>
<p>For other key types it would be serialized as an array of objects:</p>
<pre><code class="language-c++">// DataConfigTests/Public/DcTestSerDe.h
USTRUCT()
struct FDcTestStructMaps
{
    // ...
    UPROPERTY() TMap&lt;FColor, FString&gt; ColorKeyMap;
    UPROPERTY() TMap&lt;EDcTestEnumFlag, FString&gt; EnumFlagsMap;
};

// DataConfigTests/Public/DcTestDeserialize.cpp
{
    &quot;ColorKeyMap&quot; : {
        &quot;#FF0000FF&quot; : &quot;Red&quot;,
        &quot;#00FF00FF&quot; : &quot;Green&quot;,
        &quot;#0000FFFF&quot; : &quot;Blue&quot;
    },
    &quot;EnumFlagsMap&quot; : [
        {
            &quot;$key&quot; : [],
            &quot;$value&quot; : &quot;None&quot;
        },
        {
            &quot;$key&quot; : [
                &quot;One&quot;,
                &quot;Three&quot;
            ],
            &quot;$value&quot; : &quot;One | Three&quot;
        },
        {
            &quot;$key&quot; : [
                &quot;Five&quot;
            ],
            &quot;$value&quot; : &quot;Five&quot;
        }
    ]
}
</code></pre>
<h3 id="enum-flags"><a class="header" href="#enum-flags">Enum Flags</a></h3>
<p><code>UENUM</code> that get marked with <code>Bitflags</code> meta are deserialized from a list of strings:</p>
<pre><code class="language-c++">// DataConfigTests/Public/DcTestDeserialize.h
UENUM(meta = (Bitflags))
enum class EDcTestEnumFlag :uint32
{
    None    = 0,
    One     = (1 &lt;&lt; 0),
    Two     = (1 &lt;&lt; 1),
    //...
};
ENUM_CLASS_FLAGS(EDcTestEnumFlag);

// DataConfigTests/Private/DcTestDeserialize.cpp
FString Str = TEXT(R&quot;(
    {
        &quot;EnumFlagField1&quot; : [],
        &quot;EnumFlagField2&quot; : [&quot;One&quot;, &quot;Three&quot;, &quot;Five&quot;],
    }
)&quot;);

//  deserialized equivelent
FDcTestStructEnumFlag1 Expect;
Expect.EnumFlagField1 = EDcTestEnumFlag::None;
Expect.EnumFlagField2 = EDcTestEnumFlag::One | EDcTestEnumFlag::Three | EDcTestEnumFlag::Five;
</code></pre>
<h3 id="sub-objects"><a class="header" href="#sub-objects">Sub Objects</a></h3>
<p>By default we treat <code>UOBJECT</code> marked with <code>DefaultToInstanced, EditInlineNew</code> and <code>UPROPERTY</code> marked with <code>Instanced</code> as sub object. In this case we'll actually instantiate new object during deserialization, using <code>Ctx.TopObject()</code> as parent:</p>
<pre><code class="language-c++">// DataConfigTests/Public/DcTestProperty.h
UCLASS(BlueprintType, EditInlineNew, DefaultToInstanced)
class UDcBaseShape : public UObject
{
    //...
    UPROPERTY() FName ShapeName;
};

UCLASS()
class UDcShapeBox : public UDcBaseShape
{
    //...
    UPROPERTY() float Height;
    UPROPERTY() float Width;
};

UCLASS()
class UDcShapeSquare : public UDcBaseShape
{
    //...
    UPROPERTY() float Radius;
};

// DataConfigTests/Public/DcTestDeserialize.h
USTRUCT()
struct FDcTestStructShapeContainer1
{
    GENERATED_BODY()

    UPROPERTY() UDcBaseShape* ShapeField1;
    UPROPERTY() UDcBaseShape* ShapeField2;
    UPROPERTY() UDcBaseShape* ShapeField3;
}USTRUCT()
struct FDcEditorExtraTestObjectRefs1
{
    GENERATED_BODY()

    UPROPERTY() UObject* ObjField1;
    UPROPERTY() UObject* ObjField2;
    UPROPERTY() UObject* ObjField3;
    UPROPERTY() UObject* ObjField4;
};

// DataConfigTests/Private/DcTestDeserialize.cpp
FString Str = TEXT(R&quot;(
    {
        &quot;ShapeField1&quot; :  {
            &quot;$type&quot; : &quot;DcShapeBox&quot;,
            &quot;ShapeName&quot; : &quot;Box1&quot;,
            &quot;Height&quot; : 17.5,
            &quot;Width&quot; : 1.9375
        },
        &quot;ShapeField2&quot; : {
            &quot;$type&quot; : &quot;DcShapeSquare&quot;,
            &quot;ShapeName&quot; : &quot;Square1&quot;,
            &quot;Radius&quot; : 1.75,
        },
        &quot;ShapeField3&quot; : null
    }
)&quot;);

//  deserialized equivelent
UDcShapeBox* Shape1 = NewObject&lt;UDcShapeBox&gt;();
Shape1-&gt;ShapeName = TEXT(&quot;Box1&quot;);
Shape1-&gt;Height = 17.5;
Shape1-&gt;Width = 1.9375;
Expect.ShapeField1 = Shape1;

UDcShapeSquare* Shape2 = NewObject&lt;UDcShapeSquare&gt;();
Shape2-&gt;ShapeName = TEXT(&quot;Square1&quot;);
Shape2-&gt;Radius = 1.75;
Expect.ShapeField2 = Shape2;

Expect.ShapeField3 = nullptr;
</code></pre>
<p>Note that criteria for sub object selection can be easily overridden with a new deserialize predicate or alternative <code>FDcPropertyConfig</code> when constructing the reader.</p>
<p>Also see <a href="../Extra/AnyStruct.html">AnyStruct</a>, <a href="../Extra/InlineStruct.html">InlineStruct</a> and <a href="../Extra/InstancedStruct.html">InstancedStruct</a> for lighter weight alternatives.</p>
<h3 id="object-and-class-reference"><a class="header" href="#object-and-class-reference">Object and Class Reference</a></h3>
<p>We support multiple ways of referencing a <code>UObject</code> in memory or serialized on disk:</p>
<pre><code class="language-c++">// DataConfigEditorExtra/Private/DataConfig/EditorExtra/Tests/DcTestDeserializeEditor.h
USTRUCT()
struct FDcEditorExtraTestObjectRefs1
{
    GENERATED_BODY()

    UPROPERTY() UObject* ObjField1;
    UPROPERTY() UObject* ObjField2;
    UPROPERTY() UObject* ObjField3;
    UPROPERTY() UObject* ObjField4;
};

// DataConfigEditorExtra/Private/DataConfig/EditorExtra/Tests/DcTestDeserializeEditor.cpp
FString Str = TEXT(R&quot;(
    {
        &quot;ObjField1&quot; : &quot;DcEditorExtraNativeDataAsset'/DataConfig/DcFixture/DcTestNativeDataAssetAlpha.DcTestNativeDataAssetAlpha'&quot;,
        &quot;ObjField2&quot; : &quot;/DataConfig/DcFixture/DcTestNativeDataAssetAlpha&quot;,
        &quot;ObjField3&quot; : 
        {
            &quot;$type&quot; : &quot;DcEditorExtraNativeDataAsset&quot;,
            &quot;$path&quot; : &quot;/DataConfig/DcFixture/DcTestNativeDataAssetAlpha&quot;
        },
        &quot;ObjField4&quot; : null,
    }
)&quot;);

//  deserialized equivelent
UDcEditorExtraNativeDataAsset* DataAsset = Cast&lt;UDcEditorExtraNativeDataAsset&gt;(StaticLoadObject(
    UDcEditorExtraNativeDataAsset::StaticClass(),
    nullptr,
    TEXT(&quot;/DataConfig/DcFixture/DcTestNativeDataAssetAlpha&quot;),
    nullptr
));

Expect.ObjField1 = DataAsset;
Expect.ObjField2 = DataAsset;
Expect.ObjField3 = DataAsset;
Expect.ObjField4 = nullptr;
</code></pre>
<p>In the example above, <code>ObjField1</code> uses the reference string that can be retrieved in editor context menu:</p>
<p><img src="Images/Deserialize-CopyReference.png" alt="Deserialize-CopyReference" /></p>
<p>For <code>ObjField2/ObjField3</code>  relative path to the <code>uasset</code> is used, but without file name suffix.</p>
<p>We also support class reference fields of <code>TSubclassOf&lt;&gt;</code>s:</p>
<pre><code class="language-c++">// DataConfigTests/Private/DcTestDeserialize.h
USTRUCT()
struct FDcTestStructSubClass1
{
    GENERATED_BODY()

    UPROPERTY() TSubclassOf&lt;UStruct&gt; StructSubClassField1;
    UPROPERTY() TSubclassOf&lt;UStruct&gt; StructSubClassField2;
    UPROPERTY() TSubclassOf&lt;UStruct&gt; StructSubClassField3;
};

// DataConfigTests/Private/DcTestDeserialize.cpp
FString Str = TEXT(R&quot;(
    {
        &quot;StructSubClassField1&quot; : null,
        &quot;StructSubClassField2&quot; : &quot;ScriptStruct&quot;,
        &quot;StructSubClassField3&quot; : &quot;DynamicClass&quot;,
    }
)&quot;);

//  deserialized equivelent
FDcTestStructSubClass1 Expect;
Expect.StructSubClassField1 = nullptr;
Expect.StructSubClassField2 = UScriptStruct::StaticClass();
Expect.StructSubClassField3 = UDynamicClass::StaticClass();
</code></pre>
<p>Note that these do not support Blueprint classes. The direct reason is that Blueprint depends on <code>Engine</code> module and we'd like not to take dependency on in <code>DataConfigCore</code>. </p>
<p>We do have an example that supports Blueprint classes, see <code>DataConfigEditorExtra -  DcDeserializeBPClass.h/cpp</code></p>
<h2 id="soft-lazy-as-string"><a class="header" href="#soft-lazy-as-string">Soft Lazy as String</a></h2>
<p><code>DcSetupJsonSerializeHandlers()/DcSetupJsonDeserializeHandlers()</code> accepts an enum to setup alternative handlers. For now <code>StringSoftLazy</code> branch would setup special <code>FSoftObjectProperty/FLazyObjectProperty</code> handlers that directly serialize these into string. Comparing to this the default setup would always resolve the indirect reference into memory, which maybe isn't always desirable. </p>
<pre><code class="language-c++">// DataConfigTests/Private/DcTestBlurb.cpp
FDcTestStructRefs1 Source{};
UObject* TestsObject = StaticFindObject(UObject::StaticClass(), nullptr, TEXT(&quot;/Script/DataConfigTests&quot;));

Source.SoftField1 = TestsObject;
Source.LazyField1 = TestsObject;

FDcJsonWriter Writer;
DC_TRY(DcAutomationUtils::SerializeInto(&amp;Writer, FDcPropertyDatum(&amp;Source),
[](FDcSerializeContext&amp; Ctx) {
    DcSetupJsonSerializeHandlers(*Ctx.Serializer, EDcJsonSerializeType::StringSoftLazy);
}, DcAutomationUtils::EDefaultSetupType::SetupNothing));

//  serialized result
{
    // ...
    &quot;SoftField1&quot; : &quot;/Script/DataConfigTests&quot;,
    &quot;SoftField2&quot; : &quot;&quot;,
    &quot;LazyField1&quot; : &quot;C851179E-45A51045-0006AE91-F9B16EC0&quot;,
    &quot;LazyField2&quot; : &quot;00000000-00000000-00000000-00000000&quot;
}
</code></pre>
<h2 id="caveats"><a class="header" href="#caveats">Caveats</a></h2>
<p>Here're some closing notes:</p>
<ul>
<li>
<p>For meta fields like <code>$type</code> it must be the first member, meaning object fields are order dependent. This means that the JSON we're supporting is a super set of standard JSON spec (again).</p>
</li>
<li>
<p>Bundled serializers and deserializers are designed to be roundtrip-able. For example in test <code>DataConfig.Core.RoundTrip.JsonRoundtrip1_Default</code>:</p>
<ol>
<li>Serialize <code>UDcTestRoundtrip1</code> instance <code>Source</code> into JSON.</li>
<li>Then deserialize JSON above into instance <code>Dest</code>.</li>
<li>Deep-compare <code>Source</code> and <code>Dest</code>. If they're equal them we say it's a roundtrip.</li>
</ol>
<p>Note that we carefully picked float and doubles in the test case, as it's tricky to support floating point roundtrip. We might consider supporting this with alternative float parse and format routines.</p>
</li>
<li>
<p>There're many data types that can not be deserialized from JSON, for example <code>Delegate/WeakObjectReference</code>. Remember that you always have the option to override or selectively enable handlers to support additional properties that make sense in your context. See <code>DcSetupJsonDeserializeHandlers()</code> body on how handlers are registered. You can skip this method and select the ones you want and provide additional handlers.</p>
</li>
<li>
<p>The JSON handlers are designed to <em>NOT</em> read anything during the deserialization. This is crucial since <code>USTRUCT</code> can contain uninitialized fields. For example:</p>
<pre><code class="language-c++">// DataConfigTests/Private/DcTestBlurb.cpp
FString Str = TEXT(R&quot;(
    {
        // pass
    } 
)&quot;);
FDcJsonReader Reader(Str);

FDcTestExampleSimple Dest;
FDcPropertyDatum DestDatum(&amp;Dest);

DC_TRY(DcAutomationUtils::DeserializeJsonInto(&amp;Reader, DestDatum));

check(Dest.StrField.IsEmpty());
//  but Dest.IntField contains uninitialized value
DcAutomationUtils::DumpToLog(DestDatum);

// dump results
&lt;StructRoot&gt; 'DcTestExampleSimple'
|---&lt;Name&gt; 'StrField'
|---&lt;String&gt; ''
|---&lt;Name&gt; 'IntField'
|---&lt;Int32&gt; '1689777552' // &lt;- arbitrary value
&lt;StructEnd&gt; 'DcTestExampleSimple'
</code></pre>
<p>This would cause trouble when you try read a pointer field during deserialization. Remember that primitive fields might be uninitialized during deserialization when implementing your own handlers.</p>
</li>
<li>
<p>One interesting trait of the pull/push styled API is that <code>FDcJsonReader</code> does <strong>not</strong> preemptively parse number into double and convert it to <code>int/float</code> later on. When reading a number token it would do the number parsing at call site. If <code>ReadIntX()</code> is called then the number is parsed as integer. If <code>ReadFloat()/ReadDouble()</code> is called the token will be parsed as floating point.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Formats/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../Formats/MsgPack.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Formats/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../Formats/MsgPack.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
